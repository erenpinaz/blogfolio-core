if(!window.jQuery)throw"Admin scripts requires jQuery.";function configureSlugFormatting(){var $slugSource=$("input[data-slug='source']"),$slugField=$("input[data-slug='field']");0<$slugSource.length&&0<$slugField.length&&($slugSource.on("keypress",function(){$slugField.val(convertToSlug($(this).val()))}),$slugSource.on("blur",function(){$slugField.val(convertToSlug($(this).val()))}),$slugField.on("blur",function(){$(this).val(convertToSlug($(this).val()))}))}function populatePostCategories(postId){var $refresh=$('button[data-refresh="category"]'),$list=$('ul[data-list="category"]');0<$refresh.length&&$refresh.on("click",function(){0<$list.length&&$.ajax({cache:!1,url:"/admin/dashboard/populatepostcategories",type:"GET",data:{id:postId},complete:function(result){if(200===result.status){$list.empty();var categories=result.responseJSON;0===categories.length&&$list.append("<li>No categories</li>"),$(categories).each(function(){$(['<li class="list-group-item">','<div class="custom-control custom-checkbox">',"<input id=cb_"+this.id+' class="custom-control-input" type="checkbox" name="selectedCategories" value="'+this.id+'" '+(this.ischecked?"checked":null)+">",'<label for="cb_'+this.id+'" class="custom-control-label">'+this.name+"</label>","</div>","</li>"].join("")).prependTo($list)})}}})}).trigger("click")}function showModal(href){var $modalBase=$("#modal-base");if(0<$modalBase.length){var processData=function(){var $modalForm=$modalBase.find("form").first();return 0===$modalForm.length||($.validator.unobtrusive.parse($modalForm),configureSlugFormatting(),$modalForm.on("submit",function(){return $(this).valid()&&$.ajax({cache:!1,url:href,data:$modalForm.serialize(),type:"POST",success:function(result){if(result.success){$modalBase.modal("hide");var $refresh=$("button[data-refresh]");0<$refresh.length&&$refresh.trigger("click")}$modalBase.html(result),processData()}}),!1})),!1};$modalBase.load(href,function(response,status,xhr){"success"===status&&($modalBase.modal({backdrop:"static",keyboard:!1},"show"),processData())})}}function parseSocialItems(){$(".social-icon-picker").iconpicker({animation:!1});var $form=$("form");0<$form.length&&($form.removeData("validator"),$form.removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse($form)),$("a[data-ajax='delete-social-item']").on("click",function(e){e.preventDefault(),$(this).closest("li").remove()})}function postTitleFormatter(value,row){return[value,'<ul class="list-inline">','<li class="list-inline-item"><a class="edit" href="/admin/dashboard/updatepost/'+row.postid+'">Edit</a></li>','<li class="list-inline-item"><a class="remove" href="/admin/dashboard/deletepost/'+row.postid+'">Delete</a></li>',"</ul>"].join("")}function postSummaryFormatter(value){return 36<value.length?value.substring(0,36)+"...":value}function postCategoriesFormatter(value){for(var result="",i=0;i<value.length;i++)result+="<span class=\"badge badge-primary\" style='font-size: 14px;'>"+value[i].name+"</span> ";return result}function postCommentsSectionFormatter(value){return value?"Enabled":"Disabled"}function categoryNameFormatter(value,row){return[value,'<ul class="list-inline">','<li class="list-inline-item"><a class="edit" href="/admin/dashboard/updatecategory/'+row.categoryid+'">Edit</a></li>','<li class="list-inline-item"><a class="remove" href="/admin/dashboard/deletecategory/'+row.categoryid+'">Delete</a></li>',"</ul>"].join("")}function projectNameFormatter(value,row){return[value,'<ul class="list-inline">','<li class="list-inline-item"><a class="edit" href="/admin/dashboard/updateproject/'+row.projectid+'">Edit</a></li>','<li class="list-inline-item"><a class="remove" href="/admin/dashboard/deleteproject/'+row.projectid+'">Delete</a></li>',"</ul>"].join("")}function projectImageFormatter(value){return"<img src='"+value+"' width='120' alt='Media Image'>"}function mediaNameFormatter(value,row){return[value,'<ul class="list-inline">','<li class="list-inline-item"><a class="remove" href="/admin/dashboard/deletemedia/'+row.mediaid+'">Delete</a></li>','<li class="list-inline-item"><a class="showurl" href="'+row.path+'">Show URL</a></li>',"</ul>"].join("")}function mediaThumbnailFormatter(value,row){return null==value?"<div id='"+row.mediaid+"' class='media-thumb' title='"+row.name+"'><div class='progress'><div class='progress-bar progress-bar-striped active' role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100' style='width: 0'><span class='sr-only'>0 Complete</span></div></div>":"<div class='media-thumb' style='background-image: url("+value+")' title='"+row.name+"'>"}function mediaSizeFormatter(value){return fileSizeIEC(value)}function jsonDateFormatter(value){if(null!=value&&0<value.length){var date=new Date(value);return"<abbr class='initialism' title='"+date+"'>"+calculateDateDifference(date)+"</abbr>"}return"-"}function bulkDeletePost(e){e.preventDefault();var $table=$("#posts-table");if(0<$table.length){var selectedItems=$table.bootstrapTable("getSelections");if(0<selectedItems.length&&!0===confirm("Proceed with bulk operation?")){var ids=$.map(selectedItems,function(row){return row.postid});$.ajax({url:"/admin/dashboard/bulkdeletepost",type:"POST",data:JSON.stringify(ids),contentType:"application/json; charset=utf-8",dataType:"json",complete:function(){$table.bootstrapTable("refresh")}})}}}function bulkDeleteCategory(e){e.preventDefault();var $table=$("#categories-table");if(0<$table.length){var selectedItems=$table.bootstrapTable("getSelections");if(0<selectedItems.length&&!0===confirm("Proceed with bulk operation? \nOrphaned posts will be deleted in the process.")){var ids=$.map(selectedItems,function(row){return row.categoryid});$.ajax({url:"/admin/dashboard/bulkdeletecategory",type:"POST",data:JSON.stringify(ids),contentType:"application/json; charset=utf-8",dataType:"json",complete:function(){$table.bootstrapTable("refresh")}})}}}function bulkDeleteProject(e){e.preventDefault();var $table=$("#projects-table");if(0<$table.length){var selectedItems=$table.bootstrapTable("getSelections");if(0<selectedItems.length&&!0===confirm("Proceed with bulk operation?")){var ids=$.map(selectedItems,function(row){return row.projectid});$.ajax({url:"/admin/dashboard/bulkdeleteproject",type:"POST",data:JSON.stringify(ids),contentType:"application/json; charset=utf-8",dataType:"json",complete:function(){$table.bootstrapTable("refresh")}})}}}function bulkDeleteMedia(e){e.preventDefault();var $table=$("#media-table");if(0<$table.length){var selectedItems=$table.bootstrapTable("getSelections");if(0<selectedItems.length&&!0===confirm("Proceed with bulk operation?")){var ids=$.map(selectedItems,function(row){return row.mediaid});$.ajax({url:"/admin/dashboard/bulkdeletemedia",type:"POST",data:JSON.stringify(ids),contentType:"application/json; charset=utf-8",dataType:"json",complete:function(){$table.bootstrapTable("refresh")}})}}}function convertToSlug(url){return url.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")}function fileSizeIEC(a,b,c,d,e){return(e=(c=(b=Math).log)(a)/c(1024)|0,a/b.pow(1024,e)).toFixed(2)+" "+(e?"KMGTPEZY"[--e]+"iB":"Bytes")}function fileSizeSI(a,b,c,d,e){return(e=(c=(b=Math).log)(a)/c(1e3)|0,a/b.pow(1e3,e)).toFixed(2)+" "+(e?"kMGTPEZY"[--e]+"B":"Bytes")}function calculateDateDifference(dateFrom,dateTo){dateTo=void 0===dateTo?(new Date).getTime():dateTo;var days=Math.floor((dateTo-dateFrom)/1e3/60/60/24),duration=Math.floor(days/365.242);return 1<duration?duration+" years ago":1===duration?"a year ago":1<(duration=Math.floor(days/30.4368))?duration+" months ago":1===duration?"a month ago":1<(duration=days)?duration+" days ago":1===duration?"yesterday":"today"}$(function(){var $wygBody;0<($wygBody=$("textarea[data-wysiwyg='true']")).length&&$wygBody.trumbowyg({autogrow:!0}),configureSlugFormatting();var $modal;0<($modal=$("a[data-modal]")).length&&$modal.each(function(){$(this).on("click",function(e){e.preventDefault(),showModal(this.href)})});!function(){var socialItemsContainer=document.getElementById("social-items-container");null!=socialItemsContainer&&(Sortable.create(socialItemsContainer,{handle:"i.drag-handle"}),parseSocialItems());var $addSocialItem=$("a[data-ajax='add-social-item']"),$socialItemsContainer=$("#social-items-container");0<$addSocialItem.length&&0<$socialItemsContainer.length&&$addSocialItem.on("click",function(e){return e.preventDefault(),$.ajax({url:this.href,success:function(html){$(html).appendTo($socialItemsContainer).find("input[readonly]").prop("readonly",!1),parseSocialItems()}}),!1})}();var $elem,url;$elem=$("#media-uploader"),url=$elem.data("url"),$elem.length&&$("#media-uploader").dropzone({url:url,maxFilesize:5});var $browser,$trigger;$browser=$("div#imageBrowser"),($trigger=$("div#preview > button")).length&&$trigger.on("click",function(e){var url=$(this).data("url"),$container=$('div[class="card-deck"]',$browser);$.ajax({url:url,success:function(data){$container.length&&($container.empty(),$.each(data,function(i,e){$(['<div class="col-sm-4 col-md-4 col-lg-3 p-0 mb-5">','<div class="card" data-selection="'+e.path+'">','<span class="card-img-top" style="background-image: url('+e.thumbpath+');"></span>','<div class="card-footer"><small>'+e.name+"</small></div>","</div>","</div>"].join(" ")).appendTo($container)}),$browser.modal(),$(".card",$container).off("click"),$(".card",$container).on("click",function(e){$(".card",$container).removeClass("bg-primary text-white"),$(this).addClass("bg-primary text-white")}),$(".select-image").off("click"),$(".select-image").on("click",function(e){var path=$(".card.bg-primary",$container).data("selection");(void 0===path||""===path||path.length<=0)&&alert("You must select a file before proceeding."),$("div#preview > input#Image").val(path),$("div#preview > img").attr("src",path)}))}})})}),window.postTitleEvents={"click .remove":function(e,value,row,index){e.preventDefault();var id=row.postid;null!=id&&!0===confirm("Proceed with deletion?")&&$.ajax({url:"/admin/dashboard/deletepost",type:"POST",traditional:!0,data:JSON.stringify(id),contentType:"application/json; charset=utf-8",dataType:"json",complete:function(){var $table=$("#posts-table");0<$table.length&&$table.bootstrapTable("refresh")}})}},window.categoryNameEvents={"click .edit":function(e,value,row,index){e.preventDefault();var href=e.target.href;0<href.length&&showModal(href)},"click .remove":function(e,value,row,index){e.preventDefault();var id=row.categoryid;null!=id&&!0===confirm("Proceed with deletion? \nOrphaned posts will be deleted in the process.")&&$.ajax({url:e.target.href,type:"POST",traditional:!0,data:JSON.stringify(id),contentType:"application/json; charset=utf-8",dataType:"json",complete:function(){var $table=$("#categories-table");0<$table.length&&$table.bootstrapTable("refresh")}})}},window.projectNameEvents={"click .remove":function(e,value,row,index){e.preventDefault();var id=row.projectid;null!=id&&!0===confirm("Proceed with deletion?")&&$.ajax({url:"/admin/dashboard/deleteproject",type:"POST",traditional:!0,data:JSON.stringify(id),contentType:"application/json; charset=utf-8",dataType:"json",complete:function(){var $table=$("#projects-table");0<$table.length&&$table.bootstrapTable("refresh")}})}},window.mediaNameEvents={"click .remove":function(e,value,row,index){e.preventDefault();var id=row.mediaid;null!=id&&!0===confirm("Proceed with deletion?")&&$.ajax({url:e.target.href,type:"POST",traditional:!0,data:JSON.stringify(id),contentType:"application/json; charset=utf-8",dataType:"json",complete:function(){var $table=$("#media-table");0<$table.length&&$table.bootstrapTable("refresh")}})},"click .showurl":function(e,value,row,index){e.preventDefault(),window.prompt("Ctrl+C to copy to clipboard:",row.path)}},String.format||(String.format=function(format){var args=Array.prototype.slice.call(arguments,1);return format.replace(/{(\d+)}/g,function(match,number){return void 0!==args[number]?args[number]:match})});